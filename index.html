<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Libre & Rico</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <style>
    .imagen-reducida {
      max-width: 1500px;    
      width: 100%;
      max-height: 800px;
      height: auto;
    }     

    .shadow-text {
      text-shadow: 2px 2px 8px rgba(0,0,0,0.6);
    }

    .icono-navbar {
      font-size: 1.25rem;
    }

    /* Carrito desplegable */
    .carrito-dropdown-container {
      position: relative; 
    }

    #carritoDesplegable {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 5px;
      width: 300px;
      background-color: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 1050;
      border-radius: 0.25rem;
      border: 1px solid #ddd;
      max-height: 400px;
      overflow-y: auto;
    }

    .mostrar {
      display: block !important;
    }

    .carrito-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 15px;
      border-bottom: 1px dashed #eee;
      align-items: center;
    }

    .carrito-total {
      padding: 10px 15px;
      font-weight: bold;
      background-color: #f8f9fa;
      text-align: right;
      border-top: 1px solid #ccc;
    }
  </style>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light shadow-sm" style="color:rgba(67, 196, 67, 0.79)">
  <div class="container">
    <a class="navbar-brand fw-bold text-success" href="index.html">Libre & Rico, Panificados Sin Gluten</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto text-e">
        <li class="nav-item"><a class="nav-link active" href="index.html">Inicio</a></li>
        <li class="nav-item"><a class="nav-link" href="productos.html">Productos</a></li>
        <li class="nav-item" id="linkIniciarSesion"><a class="nav-link" href="B03.HTML">Inicia Sesión</a></li>
        <li class="nav-item" id="linkRegistrate"><a class="nav-link" href="B01.HTML" target="_blank">Registrate</a></li>
        <li class="nav-item"><a class="nav-link" href="B02.HTML" target="_blank" onclick="accederPortalEmpleados()">Portal Empleados</a></li>
        <li class="nav-item"><a class="nav-link" href="B09.HTML" target="_blank">Historial de pedidos</a></li>

        <li class="nav-item ms-3 carrito-dropdown-container">
          <button class="btn position-relative" onclick="alternarCarritoDesplegable(event)">
            <i class="bi bi-cart icono-navbar" style="color: green"></i>
            <span id="contadorCarrito" class="position-absolute top-50 start-100 translate-middle badge rounded-pill bg-danger"></span>
          </button>

          <div id="carritoDesplegable">
            <div id="listaProductosCarrito">
              <div class="carrito-item text-center text-muted p-3">El carrito está vacío.</div>
            </div>
            <div class="carrito-total">Total: <span id="carritoTotalMonto">$0.00</span></div>
            <div class="p-3"><a href="B08.html" class="btn btn-success w-100">Ver Carrito Completo</a></div>
          </div>
        </li>

        <li class="nav-item ms-3" id="favoritos">
          <a href="favoritos.html" class="btn position-relative">
          <i class="bi bi-heart icono-navbar"></i>
          <span id="contadorFavoritos" class="position-absolute top-50 start-100 translate-middle badge rounded-pill bg-danger"></span>
          </a>
        </li>
        <li class="nav-item dropdown ms-3" id="perfilUsuario" style="display: none;">
          <a class="nav-link dropdown-toggle" href="#" id="perfilDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person-circle icono-navbar"></i>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="perfilDropdown">
            <li><a class="dropdown-item" href="#">Perfil</a></li>
            <li><a class="dropdown-item" href="index.html" id="cerrarSesion">Cerrar sesión</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Carrusel -->
<div id="myCarousel" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="0" class="active"></button>
    <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="1"></button>
    <button type="button" data-bs-target="#myCarousel" data-bs-slide-to="2"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img id="sandwich_vegano" src="https://tiaclara.com/wp-content/uploads/2023/05/vegan-eggplant-sandwich-DSC3394.jpg" class="imagen-reducida" alt="Pan artesanal">
      <div class="carousel-caption d-none d-md-block">
        <h5 class="fw-bold shadow-text text-success">Pan artesanal sin gluten</h5>
        <p class="shadow-text">Hecho con amor, sabor y compromiso con tu bienestar.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img id="cafe_latte" src="https://www.thespruceeats.com/thmb/0CK65lVOSHILEZXSh1dVJ_Hl4Hc=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/how-to-make-caffe-latte-765372-hero-01-2417e49c4a9c4789b3abdd36885f06ab.jpg" class="imagen-reducida" alt="Café Latte">
      <div class="carousel-caption d-none d-md-block">
        <h5 class="fw-bold shadow-text text-success">Cafés </h5>
        <p class="shadow-text">Para comenzar tu día con energía.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img id="brownie" src="https://images.cookforyourlife.org/wp-content/uploads/2020/06/Dark-Chocolate-Brownies-shutterstock_112430981.jpg" class="imagen-reducida" alt="Brownie">
      <div class="carousel-caption d-none d-md-block">
        <h5 class="fw-bold shadow-text text-success">Postres</h5>
        <p class="shadow-text">El sabor perfecto para tu desayuno o café.</p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#myCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#myCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
  </button>
</div>

<!-- Sección Productos -->
<section class="py-5">
  <div class="container">
    <h2 class="text-center mb-5">Nuestros productos más elegidos</h2>
    <div class="row g-4">
      <!-- Producto -->
      <div class="col-md-4">
        <div class="card shadow-sm h-100">
          <img src="https://tiaclara.com/wp-content/uploads/2023/05/vegan-eggplant-sandwich-DSC3394.jpg" class="card-img-top" alt=" Sandwich vegano">
          <div class="card-body text-center">
            <h5 class="card-title">Sandwich vegano</h5>
            <p class="card-text">Suave, fresco y sin gluten. Ideal para tus desayunos.</p>
            <button onclick="agregarAlCarrito('sandwich vegano', 4500)" class="btn btn-success">Agregar al carrito</button>
            <button onclick="toggleFavorito('sandwich vegano', this)" class="btn btn-outline-danger">
              <i class="bi bi-heart"></i> Favorito
            </button>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card shadow-sm h-100">
          <img src="https://www.thespruceeats.com/thmb/0CK65lVOSHILEZXSh1dVJ_Hl4Hc=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/how-to-make-caffe-latte-765372-hero-01-2417e49c4a9c4789b3abdd36885f06ab.jpg" class="card-img-top" alt="Café Latte">
          <div class="card-body text-center">
            <h5 class="card-title">Café Latte</h5>
            <p class="card-text">Endulza tu día.</p>
            <button onclick="agregarAlCarrito('Café Latte', 2800)" class="btn btn-success">Agregar al carrito</button>
            <button onclick="toggleFavorito('Café Latte', this)" class="btn btn-outline-danger">
              <i class="bi bi-heart"></i> Favorito
            </button>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card shadow-sm h-100">
          <img src="https://images.cookforyourlife.org/wp-content/uploads/2020/06/Dark-Chocolate-Brownies-shutterstock_112430981.jpg" class="card-img-top" alt="Galletas artesanales">
          <div class="card-body text-center">
            <h5 class="card-title">Brownie</h5>
            <p class="card-text">Perfecto para acompañar un café o té sin culpa.</p>
            <button onclick="agregarAlCarrito('Brownie', 2000)" class="btn btn-success">Agregar al carrito</button>
            <button onclick="toggleFavorito('Brownie', this)" class="btn btn-outline-danger">
              <i class="bi bi-heart"></i> Favorito
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Sección Descriptiva -->
<section class="bg-light py-5">
  <div class="container text-center">
    <h2 class="mb-4">Hecho por amantes del pan, para amantes del pan</h2>
    <p class="lead">En <strong>Libre & Rico</strong> comer sano no significa renunciar al sabor. Mezclamos ingredientes naturales y recetas caseras, cuidando cada detalle especial para ti.</p>
  </div>
</section>

<footer class="bg-success text-white text-center py-4">
  <p class="mb-0">© 2025 Libre & Rico — Todos los derechos reservados</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function agregarAlCarrito(producto, precio) {
    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    const productoExistente = carrito.find(item => item.producto === producto);
    if (productoExistente) productoExistente.cantidad = (productoExistente.cantidad || 1) + 1;
    else carrito.push({ producto, precio, cantidad: 1 });
    localStorage.setItem("carrito", JSON.stringify(carrito));
    actualizarContadorCarrito();
    renderizarCarritoDesplegable();
  }

  function actualizarContadorCarrito() {
    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    const totalItems = carrito.reduce((sum, item) => sum + (item.cantidad || 1), 0);
    document.getElementById("contadorCarrito").textContent = totalItems ? totalItems : '';
  }

  function toggleFavorito(producto, boton) {
    let favoritos = JSON.parse(localStorage.getItem("favoritos")) || [];
    const card = boton.closest(".card");
    const imagenUrl = card.querySelector("img").src;
    const index = favoritos.findIndex(item => item.nombre === producto);

    if (index === -1) {
      favoritos.push({ nombre: producto, imagen: imagenUrl });
      boton.classList.replace("btn-outline-danger", "btn-danger");
      boton.querySelector("i").classList.replace("bi-heart", "bi-heart-fill");
    } else {
      favoritos.splice(index, 1);
      boton.classList.replace("btn-danger", "btn-outline-danger");
      boton.querySelector("i").classList.replace("bi-heart-fill", "bi-heart");
    }

    localStorage.setItem("favoritos", JSON.stringify(favoritos));
    actualizarContadorFavoritos();
  }

  function actualizarContadorFavoritos() {
    let favoritos = JSON.parse(localStorage.getItem("favoritos")) || [];
    document.getElementById("contadorFavoritos").textContent = favoritos.length ? favoritos.length : '';
  }

  function marcarFavoritos() {
    let favoritos = JSON.parse(localStorage.getItem("favoritos")) || [];
    document.querySelectorAll(".card").forEach(card => {
      let titulo = card.querySelector(".card-title").textContent;
      let boton = card.querySelector(".btn-outline-danger, .btn-danger");
      let icono = boton.querySelector("i");

      if (favoritos.some(f => f.nombre === titulo)) {
        boton.classList.replace("btn-outline-danger", "btn-danger");
        icono.classList.replace("bi-heart", "bi-heart-fill");
      } else {
        boton.classList.replace("btn-danger", "btn-outline-danger");
        icono.classList.replace("bi-heart-fill", "bi-heart");
      }
    });
  }

  function alternarCarritoDesplegable(event) {
    event.stopPropagation();
    document.getElementById('carritoDesplegable').classList.toggle('mostrar');
    if (document.getElementById('carritoDesplegable').classList.contains('mostrar')) {
      renderizarCarritoDesplegable();
    }
  }

  function renderizarCarritoDesplegable() {
    const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    const listaHTML = document.getElementById('listaProductosCarrito');
    let total = 0;
    let htmlContent = '';

    if (carrito.length === 0) {
      htmlContent = '<div class="carrito-item text-center text-muted p-3">El carrito está vacío.</div>';
    } else {
      carrito.forEach(item => {
        const cantidad = item.cantidad || 1;
        const subtotal = item.precio * cantidad;
        total += subtotal;
        const subtotalFormato = subtotal.toLocaleString('es-CL', { style: 'currency', currency: 'CLP', minimumFractionDigits: 0 });
        htmlContent += `
          <div class="carrito-item">
            <span>${item.producto} (x${cantidad})</span>
            <span class="fw-bold text-success">${subtotalFormato}</span>
          </div>
        `;
      });
    }

    listaHTML.innerHTML = htmlContent;
    document.getElementById('carritoTotalMonto').textContent = total.toLocaleString('es-CL', { style: 'currency', currency: 'CLP', minimumFractionDigits: 0 });
  }

  window.onclick = function(event) {
    const desplegable = document.getElementById('carritoDesplegable');
    const botonContainer = document.querySelector('.carrito-dropdown-container');
    if (desplegable.classList.contains('mostrar') && !botonContainer.contains(event.target)) {
      desplegable.classList.remove('mostrar');
    }
  }

  document.addEventListener("DOMContentLoaded", function () {
    actualizarContadorCarrito();
    actualizarContadorFavoritos();
    marcarFavoritos();

    const usuario = localStorage.getItem("usuario");
    const perfilElemento = document.getElementById("perfilUsuario");
    const favoritosElemento = document.getElementById("favoritos");
    const linkIniciarSesion = document.getElementById("linkIniciarSesion");
    const linkRegistrate = document.getElementById("linkRegistrate");

    if (usuario) {
      perfilElemento.style.display = "block";
      favoritosElemento.style.display = "block";
      linkIniciarSesion.style.display = "none";
      linkRegistrate.style.display = "none";
    } else {
      perfilElemento.style.display = "none";
      favoritosElemento.style.display = "none";
      linkIniciarSesion.style.display = "block";
      linkRegistrate.style.display = "block";
    }

    document.getElementById("cerrarSesion")?.addEventListener("click", function () {
      localStorage.removeItem("usuario");
      perfilElemento.style.display = "none";
      favoritosElemento.style.display = "none";
      linkIniciarSesion.style.display = "block";
      linkRegistrate.style.display = "block";
    });
  });
</script>

</body>
</html>
